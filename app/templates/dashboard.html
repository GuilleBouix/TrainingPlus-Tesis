{% extends 'base.html' %}

{% block title %}
    Dashboard - Training+
{% endblock %}

{% block content %}

  <div class="title">
      <h1>Dashboard de Entrenador</h1>
      <p>Gestiona y visualiza el progreso de tus alumnos</p>
  </div>

  <!-- Resumen en general -->
  <section class="resumen-general">
      <div class="card">
          <div class="card-title">
              <h2>Total de Alumnos</h2>
              <i class='bx bxs-group'></i>
          </div>

          <div class="card-data">
              <h3>{{ total_alumnos }}</h3>

              <p>{{ total_alumnos }} {% if total_alumnos == 1 %}alumno{% else %}alumnos{% endif %} de 6.</p>
          </div>
      </div>

      <div class="card">
          <div class="card-title">
              <h2>Cumplimiento Promedio</h2>
              <i class='bx bxs-award'></i>
          </div>

          <div class="card-data">
              <h3>0%</h3>

              <div class="bar average-progress-student" data-progreso=""></div>

              <p>Promedio de cumplimiento de los alumnos.</p>
          </div>
      </div>

      <div class="card">
          <div class="card-title">
              <h2>Progreso Promedio</h2>
              <i class='bx bx-trending-up'></i>
          </div>

          <div class="card-data">
              <h3>0%</h3>

              <div class="bar average-progress" data-progreso=""></div>

              <p>Promedio de progreso en los planes de entrenamiento.</p>
          </div>
      </div>
  </section>

  <!-- Vinculaciones reciente -->
  <section class="vinculaciones-container">
      <h2 class="section-h2">Alumnos Vinculados</h2>

      <div class="table-container">
          <table class="dashboard-table">
              <thead>
                  <tr>
                      <th scope="col">Alumno</th>
                      <th scope="col">Rutina</th>
                      <th scope="col">Fecha</th>
                      <th scope="col">Acciones</th>
                  </tr>
              </thead>
              <tbody>
                  <tr>
                      <td data-label="alumno" id="alumno">
                          <div class="foto-nombre">
                              <img src="{{ url_for('static', filename='uploads/users/profile.webp') }}" alt="">
                              <span class="nombre-alumno">Guille Bouix</span>
                          </div>
                      </td>
                      <td class="dashboard-table-rutina" data-label="entrenamiento">Aumento Masa Muscular</td>
                      <td class="dashboard-table-fecha" data-label="fecha">14/09/2025</td>
                      <td class="dashboard-table-detalles" data-label="detalles">
                          <a href="{{ url_for('dashboard.progreso_alumno', alumno_id=1) }}">Ver <i class='bx bx-chevron-right'></i></a>
                      </td>
                  </tr>
              </tbody>
          </table>
      </div>

  </section>

  <!-- Evolución fuerza (Empuje/Jale/Resistencia) -->
  <section class="rendimiento-container">
      <h2 class="section-h2">Evolución de Fuerza y Resistencia</h2>
      <p class="section-p">Porcentaje de mejora en fuerza y resistencia entre todos los alumnos.</p>

      <div style="max-width: 400px; margin: 3rem auto;">
        <canvas id="graficoDonaFuerza"></canvas>
      </div>

      <script>
        const ctxDonaFuerza = document.getElementById('graficoDonaFuerza').getContext('2d');
    
        new Chart(ctxDonaFuerza, {
          type: 'doughnut',
          data: {
            labels: ['Empuje', 'Jale', 'Resistencia'],
            datasets: [{
              data: [80, 65, 50], // tus datos reales
              backgroundColor: ['#FF7F9A', '#6ACECE', '#FFD778'],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            cutout: '65%',
            plugins: {
              legend: {
                display: true,
                position: 'bottom',
                labels: {
                  color: '#000'
                }
              },
              tooltip: {
                callbacks: {
                  label: context => `${context.label}: ${context.raw}%`
                }
              }
            }
          }
        });
      </script>

  </section>

  <!-- Ranking de cumplimiento -->
  <section class="cumplimiento-container">
    <h2 class="section-h2">Ranking de Cumplimiento</h2>
    <p class="section-p">Ranking de cumplimiento entre todos tus alumnos.</p>

    <div style="max-width: 100%; height: 400px; margin-top: 1rem;">
      <canvas id="graficoCumplimiento"></canvas>
    </div>
  
    <script>
      function crearGraficoCumplimiento() {
        const esPantallaChica = window.innerWidth <= 768;
        const ctx = document.getElementById('graficoCumplimiento').getContext('2d');
  
        if (window.rankingCumplimientoChart) {
          window.rankingCumplimientoChart.destroy();
        }
  
        window.rankingCumplimientoChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: ['Marcos', 'Valentina', 'Juan', 'Florencia', 'Luis', 'Ayelen'],
            datasets: [{
              label: 'Cumplimiento',
              data: [92, 85, 78, 65, 50, 35], // estos los podés generar desde tu backend
              backgroundColor: '#DC2626',
              borderRadius: 5,
              barThickness: 40
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            indexAxis: esPantallaChica ? 'x' : 'y',
            scales: {
              [esPantallaChica ? 'y' : 'x']: {
                beginAtZero: true,
                max: 100,
                ticks: {
                  stepSize: 20,
                  callback: value => value + '%'
                },
                grid: {
                  drawBorder: false
                }
              },
              [esPantallaChica ? 'x' : 'y']: {
                grid: {
                  drawBorder: false
                },
                ticks: {
                  color: '#000'
                }
              }
            },
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                backgroundColor: '#5B5B5B',
                titleColor: '#fff',
                bodyColor: '#fff',
                callbacks: {
                  label: context => `${context.label}: ${context.raw}%`
                }
              }
            }
          }
        });
      }
  
      crearGraficoCumplimiento();
      window.addEventListener('resize', crearGraficoCumplimiento);
    </script>
  </section>
{% endblock %}
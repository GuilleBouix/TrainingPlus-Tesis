{% extends 'base.html' %}

{% block title %}
    Progreso de Alumno - Training+
{% endblock %}

{% block content %}

    <div class="progreso-alumno-container">
        <section class="alumno-container">
            <div class="datos">
                <img src="{{ url_for('static', filename='uploads/users/profile.webp') }}" alt="">

                <div>
                    <h1 style="text-align: center;">Guille Bouix</h1>
                    <p>Rutina de Fuerza</p>
                </div>
            </div>

            <div class="progreso-plan">
                <strong>Progreso del Plan</strong>
                <span>100%</span>
    
                <div class="progress-bar-container">
                    <div class="progress-bar" data-progreso="0"></div>
                </div>
            </div>

            <div class="info">
                <div class="edad">
                    <h3>Edad</h3>
                    <span>23 años</span>
                </div>

                <div class="peso">
                    <h3>Peso</h3>
                    <span>92 kg</span>
                </div>

                <div class="altura">
                    <h3>Altura</h3>
                    <span>182 cm</span>
                </div>

                <div class="inicio">
                    <h3>Inicio</h3>
                    <span>14/01/2023</span>
                </div>
            </div>

            <div class="ficha">
                <button class="btn-open-cuestionario" id="abrir-cuestionario">
                    <i class='bx bxs-file'></i>
                    Ver Ficha Completa
                </button>
            </div>
        </section>

        <!-- Modal del cuestionario -->
        <dialog class="cuestionario-dialog" id="cuestionario-modal">
            <div class="modal-content">
                <div class="header">
                    <div class="title">
                        <strong>Ficha de Guillermo Bouix</strong>

                        <i class='bx bx-x close-modal'></i>
                    </div>
                </div>

                <div class="ficha-content">
                    <!-- Información Personal -->
                    <div class="container">
                        <h1>
                            <i class='bx bx-user'></i> Información Personal
                        </h1>

                        <div class="datos">
                            <h3>Edad</h3>
                            <span>23 años</span>
                        </div>

                        <div class="datos">
                            <h3>Experiencia</h3>
                            <span>Ninguna</span>
                        </div>

                        <div class="datos">
                            <h3>Objetivo</h3>
                            <span>Perder peso y ganar masa muscular</span>
                        </div>
                    </div>

                    <!-- Datos Físicos -->
                    <div class="container container-2">
                        <h1>
                            <i class='bx bx-ruler regla'></i> Datos Físicos
                        </h1>

                        <div class="datos">
                            <h3>Peso</h3>
                            <span>92.3 kg</span>
                        </div>

                        <div class="datos">
                            <h3>Altura</h3>
                            <span>182 cm</span>
                        </div>
                    </div>

                    <!-- Entrenamiento -->
                    <div class="container container-2">
                        <h1>
                            <i class='bx bx-dumbbell regla'></i> Entrenamiento
                        </h1>

                        <div class="datos">
                            <h3>Nivel de Actividad</h3>
                            <span>Moderado</span>
                        </div>

                        <div class="datos">
                            <h3>Frecuencia</h3>
                            <span>4 Veces por semana</span>
                        </div>

                        <div class="datos">
                            <h3>Duración de Entrenamiento</h3>
                            <span>60 minutos</span>
                        </div>
                    </div>

                    <!-- Salud -->
                    <div class="container container-2">
                        <h1>
                            <i class='bx bx-heart'></i> Estado de Salud
                        </h1>

                        <div class="datos">
                            <h3>Estado General</h3>
                            <span>Bien, sin condiciones médicas relevantes</span>
                        </div>

                        <div class="datos">
                            <h3>Lesiones</h3>
                            <span>Lesión de hombro hace dos años</span>
                        </div>

                        <div class="datos">
                            <h3>Condición Cardiovascular</h3>
                            <span>Buena</span>
                        </div>

                        <div class="datos">
                            <h3>Nivel de Estrés</h3>
                            <span>Medio</span>
                        </div>
                    </div>

                    <!-- Notas adicionales -->
                    <div class="container container-2">
                        <h1>
                            <i class='bx bx-comment'></i> Notas Adicionales
                        </h1>

                        <div class="datos">
                            <span class="nota-adicional">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Sit debitis, nobis non perferendis cupiditate at illo distinctio cumque, sed, ea repellat quo ut voluptate vero. Inventore, praesentium? Porro, temporibus eius.</span>
                        </div>

                        <button>Descargar (PDF)</button>
                    </div>
                </div>
            </div>
        </dialog>

        <div class="progreso-container">
            <section class="rendimiento">
                <h2>Rendimiento</h2>

                <canvas id="lineChart"></canvas>

                <!-- Gráfico de Rendimiento (lineal) -->
                <script>
                   const ctx = document.getElementById('lineChart').getContext('2d');
                   const lineChart = new Chart(ctx, {
                       type: 'line',
                       data: {
                       labels: ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4', 'Sem 5', 'Sem 6', 'Sem 7', 'Sem 8'],
                       datasets: [{
                           // label eliminado
                           data: [30, 40, 55, 65, 70, 75, 85, 95],
                           borderColor: '#DC2626',
                           backgroundColor: 'rgba(220, 38, 38, 0.2)', // mismo color pero transparente
                           fill: true,
                           tension: 0.3,
                           pointRadius: 5,
                           pointHoverRadius: 8,
                       }]
                       },
                       options: {
                       responsive: true,
                       plugins: {
                           legend: {
                           display: false // Oculta el rectángulo/label
                           }
                       },
                       scales: {
                           y: {
                           beginAtZero: true,
                           max: 100,
                           title: {
                               display: true,
                           }
                           },
                           x: {
                           title: {
                               display: true,
                           }
                           }
                       }
                       }
                   });
                </script>
            </section>

            <section class="evolucion-fuerza">
                <h2>Evolución de Fuerza</h2>

                <div style="width: 100%; height: 400px;">
                    <canvas id="graficoEvolucion"></canvas>
                  </div>
                  
                  <div class="navigation-buttons">
                    <button onclick="cambiarBloque(-1)">
                        <i class='bx bx-chevron-left'></i>
                    </button>

                    <button onclick="cambiarBloque(1)">
                        <i class='bx bx-chevron-right'></i>
                    </button>
                  </div>
                  
                  <script>
                    const todasLasSemanas = [
                      'Semana 1', 'Semana 2', 'Semana 3', 'Semana 4',
                      'Semana 5', 'Semana 6', 'Semana 7', 'Semana 8',
                      'Semana 9', 'Semana 10', 'Semana 11', 'Semana 12'
                    ];
                  
                    const fuerza =   [60, 65, 68, 70, 72, 74, 76, 78, 80, 82, 84, 85];
                    const jale =     [55, 58, 60, 62, 64, 67, 69, 72, 74, 76, 78, 80];
                    const resistencia = [50, 52, 54, 56, 58, 61, 64, 67, 70, 73, 76, 78];
                  
                    let bloqueActual = 0;
                    const semanasPorBloque = 4;
                  
                    const ctx2 = document.getElementById('graficoEvolucion').getContext('2d');
                    const chart = new Chart(ctx2, {
                      type: 'bar',
                      data: {
                        labels: [],
                        datasets: [
                          {
                            label: 'Empuje',
                            data: [],
                            backgroundColor: '#AAD18E',
                            borderRadius: 3
                          },
                          {
                            label: 'Jale',
                            data: [],
                            backgroundColor: '#FF99FF',
                            borderRadius: 3
                          },
                          {
                            label: 'Resistencia',
                            data: [],
                            backgroundColor: '#FFE69B',
                            borderRadius: 3
                          }
                        ]
                      },
                      options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                          y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                              callback: v => v + '%'
                            }
                          }
                        },
                        plugins: {
                          legend: {
                            position: 'top'
                          },
                          tooltip: {
                            callbacks: {
                              label: ctx => `${ctx.dataset.label}: ${ctx.raw}%`
                            }
                          }
                        }
                      }
                    });
                  
                    function actualizarGrafico() {
                      const inicio = bloqueActual * semanasPorBloque;
                      const fin = inicio + semanasPorBloque;
                  
                      chart.data.labels = todasLasSemanas.slice(inicio, fin);
                      chart.data.datasets[0].data = fuerza.slice(inicio, fin);
                      chart.data.datasets[1].data = jale.slice(inicio, fin);
                      chart.data.datasets[2].data = resistencia.slice(inicio, fin);
                      chart.update();
                    }
                  
                    function cambiarBloque(direccion) {
                      const totalBloques = Math.ceil(todasLasSemanas.length / semanasPorBloque);
                      bloqueActual = Math.min(Math.max(0, bloqueActual + direccion), totalBloques - 1);
                      actualizarGrafico();
                    }
                  
                    // Inicializar
                    actualizarGrafico();
                </script>
                  
                  


            </section>

            <section class="mejores-marcas-alumno">
                <h2>Mejores Marcas</h2>

                <div class="marcadores-container">
                    <div class="marcador">
                        <strong>Press de Banca c/ Barra</strong>
        
                        <span>100 Kg x 8</span>
                    </div>
        
                    <div class="marcador">
                        <strong>Sentadilla</strong>
        
                        <span>175 Kg x 6</span>
                    </div>
        
                    <div class="marcador">
                        <strong>Peso Mueto c/ Barra</strong>
        
                        <span>250 Kg x 4</span>
                    </div>
                </div>
            </section>

            <section class="observaciones-semanales">
                <h2>Observaciones Semanales</h2>

                <div class="observaciones">
                    <div class="observacion">
                        <div>
                            <strong>Semana 1</strong>
                            <button title="Ver Fotografía">
                                <i class='bx bxs-show'></i>
                            </button>
                        </div>

                        <p class="observacion-texto">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Officiis molestias, ducimus repudiandae quo deserunt ad numquam expedita voluptatem sit cumque non quibusdam assumenda officia inventore facere. Porro nobis maxime magnam!</p>
                    </div>
                </div>

                <div class="observaciones">
                    <div class="observacion">
                        <div>
                            <strong>Semana 2</strong>
                            <button title="Ver Fotografía">
                                <i class='bx bxs-show'></i>
                            </button>
                        </div>

                        <p class="observacion-texto">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Officiis molestias, ducimus repudiandae quo deserunt ad numquam expedita voluptatem sit cumque non quibusdam assumenda officia inventore facere. Porro nobis maxime magnam!</p>
                    </div>
                </div>

                <div class="observaciones">
                    <div class="observacion">
                        <div>
                            <strong>Semana 3</strong>
                            <button title="Ver Fotografía">
                                <i class='bx bxs-show'></i>
                            </button>
                        </div>

                        <p class="observacion-texto">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Officiis molestias, ducimus repudiandae quo deserunt ad numquam expedita voluptatem sit cumque non quibusdam assumenda officia inventore facere. Porro nobis maxime magnam!</p>
                    </div>
                </div>
                
            </section>
        </div>
    </div>

    <!-- Script para abrir y cerrar el modal del cuestionario -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const modal = document.getElementById("cuestionario-modal");
            const abrirBtn = document.querySelector(".btn-open-cuestionario");
            const cerrarBtn = modal.querySelector(".close-modal");
        
            // Abrir modal
            abrirBtn.addEventListener("click", () => {
                modal.showModal();
            });
        
            // Cerrar con el icono <i>
            cerrarBtn.addEventListener("click", () => {
                modal.close();
            });
        
            // Cerrar haciendo clic afuera del contenido
            modal.addEventListener("click", (e) => {
                if (e.target === modal) {
                    modal.close();
                }
            });
        });
    </script>

{% endblock %}
{% extends 'base.html' %}

{% block title %}
    {{ entrenamiento.nombre_entrenamiento }} - Training+
{% endblock %}

{% block content %}
    <div class="routine-container">
        <div class="routine-header">
            <div class="title">
                <h1>{{ entrenamiento.nombre_entrenamiento }}</h1>
                <div class="routine-data">
                    <p>Disciplina: {{ entrenamiento.nombre_disciplina }}</p>
                    <p>Duración: {{ entrenamiento.duracion_semanas }} Semanas</p>
                </div>
            </div>
        </div>

        <div class="plan-container">
            <div class="weeks">
                <button class="previous-week" title="Anterior"><i class='bx bx-chevrons-left'></i></button>
                <h1>Semana <span id="week-number">1</span></h1>
                <button class="next-week" title="Siguiente"><i class='bx bx-chevrons-right'></i></button>
            </div>
        </div>

        {% for semana in semanas %}
            <div class="accordion week-container" data-week="{{ semana.numero_semana }}" {% if loop.first %}style="display:block;"{% else %}style="display:none;"{% endif %}>
                {% for dia in semana.dias %}
                <div class="accordion-item">
                    <div class="accordion-header">
                        <h1><span>Día {{ dia.numero_dia }}</span> - {{ dia.nombre_rutina }}</h1>
                        <span class="icon"><i class='bx bx-chevron-down'></i></span>
                    </div>
                    <div class="accordion-content">
                        {% for ejercicio in dia.ejercicios %}
                            <div class="excercise">
                                <div class="excercise-title">
                                    <h3>{{ ejercicio.nombre_ejercicio }}</h3>
                                </div>
                                <div class="parameters">
                                    <p class="sets"><i class='bx bx-dumbbell'></i> {{ ejercicio.series }} Series</p>
                                    <p class="reps">{{ ejercicio.repeticiones }} Repeticiones</p>
                                    <p class="rest"><i class='bx bx-time-five'></i> {{ ejercicio.tiempo_descanso }}s Descanso</p>
                                </div>
                                <button class="btn-see-exercise"><i class='bx bxs-show'></i> Ver Ejercicio</button>

                                <form action="" method="">
                                    <div class="registers">
                                        <div>
                                            <label for="sets">¿Cuántas series pudiste hacer?</label>
                                            <input id="sets" name="sets" type="number" min="1" required>
                                        </div>
                                        <div>
                                            <label for="reps">¿Cuántas repeticiones pudiste hacer?</label>
                                            <input id="reps" name="reps" type="number" min="1" required>
                                        </div>
                                        <div>
                                            <label for="weight">¿Cuánto peso utilizaste?</label>
                                            <input id="weight" name="weight" type="number" step="0.01" min="1" required>
                                        </div>
                                    </div>
                                    <label for="observations">Observaciones</label>
                                    <textarea name="observations" required maxlength="500"></textarea>
                                    <button type="submit" class="btn-see-exercise save-day">Guardar Registro</button>
                                </form>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        {% endfor %}
    </div>
    
    <!-- Script para abrir y cerrar el acordeon -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            document.querySelectorAll('.accordion-header').forEach(header => {
                header.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const content = this.nextElementSibling;

                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;  // Cierra el acordeón
                    } else {
                        content.style.maxHeight = "0px";  // Asegura el inicio correcto
                        requestAnimationFrame(() => {
                            content.style.maxHeight = content.scrollHeight + "px"; // Expande suavemente
                        });
                    }
                });
            });
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            let currentWeek = 1;
            const totalWeeks = document.querySelectorAll('.week-container').length;
            
            document.querySelector(".next-week").addEventListener("click", function() {
                if (currentWeek < totalWeeks) {
                    document.querySelector(`.week-container[data-week="${currentWeek}"]`).style.display = "none";
                    currentWeek++;
                    document.querySelector(`.week-container[data-week="${currentWeek}"]`).style.display = "block";
                    document.getElementById("week-number").textContent = currentWeek;
                }
            });

            document.querySelector(".previous-week").addEventListener("click", function() {
                if (currentWeek > 1) {
                    document.querySelector(`.week-container[data-week="${currentWeek}"]`).style.display = "none";
                    currentWeek--;
                    document.querySelector(`.week-container[data-week="${currentWeek}"]`).style.display = "block";
                    document.getElementById("week-number").textContent = currentWeek;
                }
            });

            document.querySelectorAll('.accordion-header').forEach(header => {
                header.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const content = this.nextElementSibling;
                    content.style.display = content.style.display === "block" ? "none" : "block";
                });
            });
        });
    </script>

{% endblock %}